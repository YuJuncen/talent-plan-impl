use kvs::contract::KvContractMessage;
use kvs::engines::engine::KvsEngine;
use kvs::KvStore;
use kvs::Result;

fn main() -> Result<()> {
    let path = std::env::current_dir().unwrap();
    let mut store = KvStore::open(&path)?;

    store.set("key1".to_owned(), "value1".to_owned())?;
    assert_eq!(store.get("key1".to_owned())?, Some("value1".to_owned()));
    store.set("key1".to_owned(), "value2".to_owned())?;
    assert_eq!(store.get("key1".to_owned())?, Some("value2".to_owned()));

    // Open from disk again and check persistent data
    drop(store);
    let mut store = KvStore::open(&path)?;
    assert_eq!(store.get("key1".to_owned())?, Some("value2".to_owned()));
    store.set("key1".to_owned(), "value3".to_owned())?;
    assert_eq!(store.get("key1".to_owned())?, Some("value3".to_owned()));

    Ok(())
}
